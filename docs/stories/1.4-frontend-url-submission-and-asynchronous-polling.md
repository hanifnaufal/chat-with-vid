<!-- Powered by BMADâ„¢ Core -->

# Story 1.4: Frontend URL Submission & Asynchronous Polling

## Status
In Progress

## Story
**As an** Efficient Learner,
**I want** to paste a YouTube URL into the app and get immediate feedback,
**so that** I can see my request is being handled without blocking the interface.

## Epic
This story is part of Epic 1: Foundation & Core Video Chat, which aims to establish the complete project foundation, process a YouTube video to retrieve its transcript and metadata, and enable a user to have a live, context-aware conversation with its content. By the end of this epic, a user can input a URL, receive an initial analysis, and have a complete chat session.

This story specifically addresses the frontend implementation for URL submission and asynchronous polling, which is a critical part of the user experience when processing a new video.

## Acceptance Criteria
1. The home page contains a single input field for a YouTube URL and a "Process" button (FR1).
2. When the "Process" button is clicked, a POST request is sent to the /api/chats endpoint.
3. Upon receiving a chat_id, the application navigates to the analysis page (/chat/{chat_id}).
4. The analysis page immediately displays a loading state and begins polling a new endpoint, GET /api/chats/{chat_id}, to check the processing status.
5. The loading state must be descriptive, showing the user the current stage of the process (e.g., "Step 1/3: Fetching transcript...", "Step 2/3: Analyzing content...", "Step 3/3: Generating summary...").
6. If the API returns an error during submission, a user-friendly error message is displayed.
7. The polling mechanism uses TanStack Query for efficient state management and automatic retries.
8. The polling interval is set to 2 seconds to provide timely updates without overwhelming the server.
9. The loading state updates in real-time to reflect the backend processing status.
10. When processing completes (either successfully or with an error), polling stops automatically.

## Tasks / Subtasks
- [x] Task 1: Create Home Page UI with URL Input (AC: 1)
  - [x] Subtask 1.1: Implement the main input page at `/` route
  - [x] Subtask 1.2: Add a YouTube URL input field with proper validation
  - [x] Subtask 1.3: Add a "Process" button that triggers the submission
  - [x] Subtask 1.4: Implement form validation for YouTube URLs
  - [x] Subtask 1.5: Add error display for invalid URLs

- [ ] Task 2: Implement URL Submission to Backend API (AC: 2, 6)
  - [ ] Subtask 2.1: Create chatService with createChat function
  - [ ] Subtask 2.2: Implement API client with proper error handling
  - [ ] Subtask 2.3: Add form submission handler that calls the API
  - [ ] Subtask 2.4: Handle API errors and display user-friendly messages
  - [ ] Subtask 2.5: Implement loading state during submission

- [ ] Task 3: Implement Navigation to Analysis Page (AC: 3)
  - [ ] Subtask 3.1: Navigate to /chat/{chat_id} after successful submission
  - [ ] Subtask 3.2: Pass the chat_id to the analysis page
  - [ ] Subtask 3.3: Handle navigation errors gracefully

- [ ] Task 4: Create Analysis Page with Loading State (AC: 4, 5, 9)
  - [ ] Subtask 4.1: Create dynamic route at /chat/[id]/page.tsx
  - [ ] Subtask 4.2: Implement initial loading state with step indicators
  - [ ] Subtask 4.3: Add descriptive messages for each processing step
  - [ ] Subtask 4.4: Implement visual feedback for loading state

- [ ] Task 5: Implement Asynchronous Polling Mechanism (AC: 4, 7, 8, 10)
  - [ ] Subtask 5.1: Use TanStack Query for polling the GET /api/chats/{chat_id} endpoint
  - [ ] Subtask 5.2: Configure polling interval to 2 seconds
  - [ ] Subtask 5.3: Implement automatic polling stop on completion or error
  - [ ] Subtask 5.4: Handle polling errors with appropriate retries
  - [ ] Subtask 5.5: Update loading state based on backend status

## Dev Notes

### Implementation Plan

Based on the architecture documents, we need to implement the following frontend components:

1. **Home Page Component**: Create a clean, focused input page at the root route (/) with a YouTube URL input field and Process button
2. **API Service Layer**: Implement a chatService using the defined service template that handles communication with the backend API
3. **API Client**: Use the centralized API client configuration for consistent error handling and base URL management
4. **Analysis Page Component**: Create a dynamic route at /chat/[id] that displays the loading state and handles polling
5. **State Management**: Use TanStack Query for server state management and polling
6. **Error Handling**: Implement comprehensive error handling for both form validation and API errors
7. **Navigation**: Use Next.js App Router for navigation between pages

### Implementation Details

- The home page will be implemented as src/app/page.tsx with a clean, centered layout
- The URL input field will use Shadcn/ui components for consistent styling
- Form validation will check for valid YouTube URLs before submission
- The chatService will implement the createChat function that POSTs to /api/chats
- The analysis page will use TanStack Query's useQuery hook with refetchInterval for polling
- Loading states will show detailed progress information as specified in the requirements
- Error messages will be user-friendly and provide guidance on next steps
- All components will follow the defined component standards with TypeScript interfaces

### Relevant Architecture Documents

- [Frontend Spec - User Flows](/home/hanifnaufal/Projects/chat-with-vid/docs/front-end-spec.md#processing-a-new-video) - Defines the user flow for processing a new video including URL submission and loading states
- [Frontend Spec - Home/Input Screen](/home/hanifnaufal/Projects/chat-with-vid/docs/front-end-spec.md#homeinput-screen) - Specifies the design and interaction patterns for the home page
- [UI Architecture - Project Structure](/home/hanifnaufal/Projects/chat-with-vid/docs/ui-architecture.md#section-3-project-structure) - Defines the directory structure for the frontend application
- [UI Architecture - API Integration](/home/hanifnaufal/Projects/chat-with-vid/docs/ui-architecture.md#section-6-api-integration) - Specifies the service layer pattern for API interactions
- [UI Architecture - Routing](/home/hanifnaufal/Projects/chat-with-vid/docs/ui-architecture.md#section-7-routing) - Details the routing configuration using Next.js App Router
- [Architecture - REST API Spec](/home/hanifnaufal/Projects/chat-with-vid/docs/architecture/8-rest-api-spec.md) - Defines the backend API endpoints for chat creation and retrieval
- [Architecture - Core Workflows](/home/hanifnaufal/Projects/chat-with-vid/docs/architecture/7-core-workflows.md) - Illustrates the sequence diagram for processing a new video
- [Architecture - Components](/home/hanifnaufal/Projects/chat-with-vid/docs/architecture/5-components.md) - Describes the API Server component that handles the /api/chats endpoints

### Technology Considerations

- Use Next.js App Router for page routing and dynamic routes
- Use Shadcn/ui components for consistent, accessible UI elements
- Use TanStack Query for server state management and polling
- Use the defined API client pattern for HTTP requests
- Follow the component standards defined in the UI architecture
- Implement proper TypeScript typing for all components and services
- Use Tailwind CSS utility classes for styling with the cn utility for class merging

### Previous Story Context

This story builds upon Story 1.3: Backend API for Video Chat Creation, which implemented the backend endpoint POST /api/chats that accepts a YouTube URL, creates a new chat record, kicks off an asynchronous job to process the video, and immediately returns a unique chat_id. The frontend implementation in this story will consume that API endpoint.

### QA References

This story will need comprehensive testing including:
- Unit tests for all components using Jest and React Testing Library
- Integration tests for the API service layer
- End-to-end tests to verify the complete flow from URL submission to loading state
- Accessibility testing to ensure proper keyboard navigation and screen reader support
- Responsive design testing across different device sizes

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-23 | 1.0 | Initial story creation based on epic list and architecture documents | Qwen Code Assistant |
| 2025-09-23 | 1.1 | Added epic context, specific document references, and previous story context | Qwen Code Assistant |

## Dev Agent Record

### Agent Model Used
Frontend Developer

### Debug Log References

### Completion Notes List

### File List
- apps/web/src/app/page.tsx
- apps/web/src/app/chat/[id]/page.tsx
- apps/web/src/lib/services/chatService.ts
- apps/web/src/lib/api-client.ts
- apps/web/src/components/custom/UrlInputForm.tsx
- apps/web/src/components/custom/LoadingState.tsx
- apps/web/src/components/Providers.tsx
- apps/web/src/lib/utils.ts
- apps/web/.env.local

## QA Results

## Recommendations Implemented